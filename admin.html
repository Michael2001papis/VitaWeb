<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>פאנל מנהל - VitaWeb</title>
  <style>
    :root { --brand:#0ea5e9; --brand-2:#0369a1; --danger:#dc2626; --ok:#22c55e; }
    body { font-family: Arial, Helvetica, sans-serif; background:#f6f7fb; color:#0f172a; margin:0 }
    .container { max-width: 900px; margin: 0 auto; padding: 1rem; }
    .card { background:#fff; border:1px solid #e2e8f0; border-radius:.6rem; padding:1rem; margin-bottom:1rem }
    .btn { display:inline-block; padding:.7rem 1.1rem; border-radius:.6rem; text-decoration:none; border:none; cursor:pointer }
    .btn-primary { background:var(--brand); color:#fff }
    .btn-danger { background:var(--danger); color:#fff }
    .btn-ghost { background:#fff; color:#0f172a; border:1px solid #cbd5e1 }
    .hidden { display:none }
    .login-form { max-width:400px; margin:2rem auto; text-align:center }
    .dashboard { display:grid; gap:1rem }
    .stats { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:1rem }
    .stat-card { background:linear-gradient(135deg, #eef6ff, #f0f9ff); border:2px solid var(--brand); text-align:center; padding:1.5rem }
    .stat-number { font-size:2rem; font-weight:800; color:var(--brand); margin:.5rem 0 }
    .leads-table { width:100%; border-collapse:collapse; margin-top:1rem }
    .leads-table th, .leads-table td { padding:.5rem; border:1px solid #e2e8f0; text-align:right }
    .leads-table th { background:#f8fafc; font-weight:600 }
    .status-new { background:#fef3c7; color:#92400e; padding:.2rem .5rem; border-radius:.3rem; font-size:.8rem }
    .status-contacted { background:#dbeafe; color:#1e40af; padding:.2rem .5rem; border-radius:.3rem; font-size:.8rem }
    .status-quoted { background:#d1fae5; color:#065f46; padding:.2rem .5rem; border-radius:.3rem; font-size:.8rem }
    input, textarea, select { width:100%; padding:.6rem; border:1px solid #cbd5e1; border-radius:.4rem; font-family:inherit; margin:.5rem 0 }
    input:focus, textarea:focus, select:focus { outline:3px solid var(--brand); outline-offset:2px }
  </style>
</head>
<body>
  <div class="container">
    <!-- מסך כניסה -->
    <div id="loginScreen" class="login-form">
      <div class="card">
        <h1 style="margin:0 0 1rem 0; color:var(--brand);">פאנל מנהל VitaWeb</h1>
        <form id="loginForm">
          <div>
            <label for="username" style="display:block; text-align:right; margin-bottom:.2rem;">שם משתמש</label>
            <input id="username" name="username" type="text" required>
          </div>
          <div>
            <label for="password" style="display:block; text-align:right; margin-bottom:.2rem;">סיסמה</label>
            <input id="password" name="password" type="password" required>
          </div>
          <button type="submit" class="btn btn-primary" style="margin-top:1rem;">התחבר</button>
        </form>
        <p id="loginError" style="color:var(--danger); margin:1rem 0 0 0; display:none;">שם משתמש או סיסמה שגויים</p>
      </div>
    </div>

    <!-- דשבורד מנהל -->
    <div id="dashboard" class="hidden">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
        <h1 style="margin:0; color:var(--brand);">פאנל מנהל VitaWeb</h1>
        <button id="logoutBtn" class="btn btn-danger">התנתק</button>
      </div>

      <!-- סטטיסטיקות -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="totalLeads">0</div>
          <div>סה"כ לידים</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="newLeads">0</div>
          <div>לידים חדשים</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="contactedLeads">0</div>
          <div>לידים שטופלו</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="quotedLeads">0</div>
          <div>הצעות מחיר</div>
        </div>
      </div>

      <!-- טבלת לידים -->
      <div class="card">
        <h2 style="margin:0 0 1rem 0;">לידים אחרונים</h2>
        <div style="margin-bottom:1rem;">
          <button id="addLeadBtn" class="btn btn-primary">הוסף ליד חדש</button>
          <button id="refreshBtn" class="btn btn-ghost">רענן</button>
        </div>
        <table class="leads-table" id="leadsTable">
          <thead>
            <tr>
              <th>תאריך</th>
              <th>שם</th>
              <th>טלפון</th>
              <th>עיר</th>
              <th>שירות</th>
              <th>סטטוס</th>
              <th>פעולות</th>
            </tr>
          </thead>
          <tbody id="leadsTableBody">
            <!-- ימולא דינמית -->
          </tbody>
        </table>
      </div>

      <!-- הוספת ליד -->
      <div id="addLeadForm" class="card hidden">
        <h2 style="margin:0 0 1rem 0;">הוספת ליד חדש</h2>
        <form id="newLeadForm">
          <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:1rem;">
            <div>
              <label for="newName">שם מלא</label>
              <input id="newName" name="name" type="text" required>
            </div>
            <div>
              <label for="newPhone">טלפון</label>
              <input id="newPhone" name="phone" type="tel" required>
            </div>
            <div>
              <label for="newCity">עיר</label>
              <input id="newCity" name="city" type="text" required>
            </div>
            <div>
              <label for="newService">שירות</label>
              <select id="newService" name="service">
                <option value="">בחר שירות</option>
                <option>אינסטלציה</option>
                <option>חשמל</option>
                <option>נגרות</option>
                <option>תליית טלוויזיה</option>
                <option>אחר</option>
              </select>
            </div>
            <div>
              <label for="newStatus">סטטוס</label>
              <select id="newStatus" name="status">
                <option value="new">חדש</option>
                <option value="contacted">טופל</option>
                <option value="quoted">הוצעה</option>
                <option value="won">נסגר</option>
                <option value="lost">אבוד</option>
              </select>
            </div>
          </div>
          <div>
            <label for="newDescription">תיאור</label>
            <textarea id="newDescription" name="description" rows="3"></textarea>
          </div>
          <div style="margin-top:1rem;">
            <button type="submit" class="btn btn-primary">שמור ליד</button>
            <button type="button" id="cancelAddBtn" class="btn btn-ghost">ביטול</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // נתונים מקומיים (במקום מסד נתונים)
    let leads = JSON.parse(localStorage.getItem('vitaweb_leads') || '[]');
    let currentUser = null;

    // פונקציות עזר
    function saveLeads() {
      localStorage.setItem('vitaweb_leads', JSON.stringify(leads));
      updateStats();
    }

    function updateStats() {
      const total = leads.length;
      const newLeads = leads.filter(l => l.status === 'new').length;
      const contacted = leads.filter(l => l.status === 'contacted').length;
      const quoted = leads.filter(l => l.status === 'quoted').length;

      document.getElementById('totalLeads').textContent = total;
      document.getElementById('newLeads').textContent = newLeads;
      document.getElementById('contactedLeads').textContent = contacted;
      document.getElementById('quotedLeads').textContent = quoted;
    }

    function renderLeadsTable() {
      const tbody = document.getElementById('leadsTableBody');
      tbody.innerHTML = leads.map(lead => `
        <tr>
          <td>${new Date(lead.date).toLocaleDateString('he-IL')}</td>
          <td>${lead.name}</td>
          <td><a href="tel:${lead.phone}">${lead.phone}</a></td>
          <td>${lead.city}</td>
          <td>${lead.service || '-'}</td>
          <td><span class="status-${lead.status}">${getStatusText(lead.status)}</span></td>
          <td>
            <button onclick="editLead(${lead.id})" class="btn btn-ghost" style="padding:.3rem .6rem; font-size:.8rem;">ערוך</button>
            <button onclick="deleteLead(${lead.id})" class="btn btn-danger" style="padding:.3rem .6rem; font-size:.8rem;">מחק</button>
          </td>
        </tr>
      `).join('');
    }

    function getStatusText(status) {
      const statuses = {
        'new': 'חדש',
        'contacted': 'טופל',
        'quoted': 'הוצעה',
        'won': 'נסגר',
        'lost': 'אבוד'
      };
      return statuses[status] || status;
    }

    function editLead(id) {
      const lead = leads.find(l => l.id === id);
      if (!lead) return;
      
      // פותח את הטופס עם הנתונים
      document.getElementById('addLeadForm').classList.remove('hidden');
      document.getElementById('newName').value = lead.name;
      document.getElementById('newPhone').value = lead.phone;
      document.getElementById('newCity').value = lead.city;
      document.getElementById('newService').value = lead.service || '';
      document.getElementById('newStatus').value = lead.status;
      document.getElementById('newDescription').value = lead.description || '';
      
      // שומר את ה-ID לעריכה
      document.getElementById('newLeadForm').dataset.editId = id;
    }

    function deleteLead(id) {
      if (confirm('האם למחוק את הליד?')) {
        leads = leads.filter(l => l.id !== id);
        saveLeads();
        renderLeadsTable();
      }
    }

    // אירועי כניסה
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      if (username === 'MOMO' && password === '112233') {
        currentUser = { username, password };
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        updateStats();
        renderLeadsTable();
      } else {
        document.getElementById('loginError').style.display = 'block';
      }
    });

    // אירועי דשבורד
    document.getElementById('logoutBtn').addEventListener('click', () => {
      currentUser = null;
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('loginForm').reset();
      document.getElementById('loginError').style.display = 'none';
    });

    document.getElementById('addLeadBtn').addEventListener('click', () => {
      document.getElementById('addLeadForm').classList.remove('hidden');
      document.getElementById('newLeadForm').reset();
      delete document.getElementById('newLeadForm').dataset.editId;
    });

    document.getElementById('cancelAddBtn').addEventListener('click', () => {
      document.getElementById('addLeadForm').classList.add('hidden');
    });

    document.getElementById('refreshBtn').addEventListener('click', () => {
      renderLeadsTable();
      updateStats();
    });

    document.getElementById('newLeadForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const editId = e.target.dataset.editId;
      
      const leadData = {
        name: formData.get('name'),
        phone: formData.get('phone'),
        city: formData.get('city'),
        service: formData.get('service'),
        status: formData.get('status'),
        description: formData.get('description'),
        date: new Date().toISOString()
      };

      if (editId) {
        // עריכה
        const index = leads.findIndex(l => l.id == editId);
        if (index !== -1) {
          leads[index] = { ...leads[index], ...leadData };
        }
      } else {
        // הוספה
        leadData.id = Date.now();
        leads.push(leadData);
      }

      saveLeads();
      renderLeadsTable();
      document.getElementById('addLeadForm').classList.add('hidden');
      e.target.reset();
    });

    // טעינה ראשונית
    updateStats();
  </script>
  <button id="creditsBtn" class="btn btn-ghost" style="position:fixed; right:1rem; bottom:1rem;">זכויות יוצרים</button>
  <div id="creditsModal" style="position:fixed; inset:0; background:#0008; display:none; align-items:center; justify-content:center; z-index:50">
    <div style="background:#fff; border-radius:.8rem; padding:1rem; max-width:520px; width:90%; box-shadow:0 10px 30px #0003" role="dialog" aria-modal="true" aria-labelledby="creditsTitle">
      <h3 id="creditsTitle" style="margin:0 0 .5rem 0; color:var(--brand);">זכויות יוצרים</h3>
      <p style="margin:.2rem 0"><strong>הנדימן:</strong> VitaWeb – 050-853-5941</p>
      <p style="margin:.2rem 0"><strong>מפתח האתר:</strong> מיכאל פפיסמדוב (חתימה: Mpb)</p>
      <div style="text-align:left; margin-top:1rem;">
        <button id="closeCredits" class="btn btn-primary">סגור</button>
      </div>
    </div>
  </div>
  <script>
    (function(){
      const btn = document.getElementById('creditsBtn');
      const modal = document.getElementById('creditsModal');
      const closeBtn = document.getElementById('closeCredits');
      if(btn && modal && closeBtn){
        btn.addEventListener('click', ()=>{ modal.style.display='flex'; });
        closeBtn.addEventListener('click', ()=>{ modal.style.display='none'; });
        modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.style.display='none'; });
      }
    })();
  </script>
</body>
</html>
